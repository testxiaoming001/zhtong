<?php/** *  +---------------------------------------------------------------------- *  | 中通支付系统 [ WE CAN DO IT JUST THINK ] *  +---------------------------------------------------------------------- *  | Copyright (c) 2018 http://www.iredcap.cn All rights reserved. *  +---------------------------------------------------------------------- *  | Licensed ( https://www.apache.org/licenses/LICENSE-2.0 ) *  +---------------------------------------------------------------------- *  | Author: Brian Waring <BrianWaring98@gmail.com> *  +---------------------------------------------------------------------- */namespace app\index\controller;use app\common\controller\Common;use app\common\logic\Log;use app\common\logic\TgLogic;use think\Request;use think\Route;class Tg extends Common{    protected $tgLogic;    public function __construct(Request $request = null, TgLogic $tgLogic)    {        parent::__construct($request);        $this->tgLogic = $tgLogic;    }    /**     * 设置tg消息回调通知地址     */    public function setNotifyUrl(Request $request)    {        $webHook = $request->domain() . '/index/tg/notify';        $ret = $this->tgLogic->setWebHook($webHook);        var_dump($ret);    }    /**     * @return bool     */    public function notify(Request $request)    {        $json = file_get_contents("php://input");        \think\Log::notice("TG机器人回调参数：" . $json);        $data = json_decode($json, true);        //有可能是发送消息 有可能是编辑消息        $pushMsg = isset($data['message']) ? $data['message'] : $data['edited_message'];        //parse各种事件  消息事件&行为事件        //1.简单文本事件        try {            //发送图片事件            if (array_key_exists('photo', $pushMsg)) {                $this->tgLogic->handlePhoto($pushMsg);                return;            }            //简单文本事件            if (true) {                $this->tgLogic->handleText($pushMsg);                return;            }        } catch (\Exception $exception) {            \think\Log::error("tg回调处理异常：" . $exception->getMessage());        }    }}