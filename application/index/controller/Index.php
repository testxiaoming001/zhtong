<?php/** *  +---------------------------------------------------------------------- *  | 中通支付系统 [ WE CAN DO IT JUST THINK ] *  +---------------------------------------------------------------------- *  | Copyright (c) 2018 http://www.iredcap.cn All rights reserved. *  +---------------------------------------------------------------------- *  | Licensed ( https://www.apache.org/licenses/LICENSE-2.0 ) *  +---------------------------------------------------------------------- *  | Author: Brian Waring <BrianWaring98@gmail.com> *  +---------------------------------------------------------------------- */namespace app\index\controller;use app\common\controller\Common;use think\Request;class Index extends Common{    /**     * 首页     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function index()    {        $this->redirect(url('user/index'));        return $this->fetch();    }    /**     * 产品介绍     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function products()    {        return $this->fetch();    }    /**     * 开发文档     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function document()    {        return $this->fetch();    }    /*     *接口文档下载     *     */    public function download()    {        $downLoadType = [            './demo.zip', './wendang.doc', './df_wendang.doc'        ];        downloadFile($downLoadType[$this->request->param('type', 0)]);    }    /**     * Demo演示     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function demo()    {        return $this->fetch();    }    /**     * 开发指南     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function introduce()    {        return $this->fetch();    }    /**     * SDK下载     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function sdk()    {        return $this->fetch();    }    /**     * 关于我们     *     * @return mixed     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function about()    {        return $this->fetch();    }    /**     * 发送验证码【测试】     *     * @author 勇敢的小笨羊 <brianwaring98@gmail.com>     *     */    public function sendVerCode()    {        $user = session('user_info');        if (empty($user['phone'])) {            $this->result('0', '请先绑定手机号码');        }        //验证密码        if (($user['auth_code']) !== data_md5($this->request->post('code'))) {            $this->result('0', '安全码错误');        }        $this->request->isPost() && $this->result(            $this->logicBase->sendCode($user['phone'])        );    }    /**     * 改变订单首次访问时间     */    public function pay()    {        $trade_no = $this->request->get('trade_no');        $order = $this->modelOrders->getTradeOrder($trade_no);        if ($order) {            //后续不必判断 返回数字即可            $this->modelOrders->changeOrderStatusValue(['visite_time' => time()], ['trade_no' => $trade_no]);            $this->assign("amount", sprintf("%.2f", $order['real_need_amount']));            $this->assign("image_url", $order['image_url']);        }        return $this->fetch("zfbpay");    }    /**     * 根据跑分码商的id获取指定的商户列表  =》商户列表可以指定代付到码商     */    public function getMchByMsId(Request $request)    {        $mchId = $request->post('mch_id', 1);        $fields  = 'a.uid,a.username,b.enable';        $users = $this->modelUser->alias('a')            ->join('balance b','a.uid=b.uid','left')            ->where('find_in_set(' . $mchId . ',pao_ms_ids)')            ->field($fields)            ->select();        return $this->result(1,'success',$users);    }}